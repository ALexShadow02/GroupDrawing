<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawing studio</title>
    <link rel = "stylesheet" href = "styles/studio.css">
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.4.0/fabric.min.js"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
</head>
<body>
    <div id = "container">
    <div id="toolbar">
        <div class = "tool" id = "move">
            <img src="assets/toolbar/pointer-on.svg" draggable = "false">
        </div>
        <div class = "tool" id = "pencil"> 
            <img src="assets/toolbar/pencil.svg" draggable = "false">
        </div>
        <div class = "tool" id = "fill">
            <img src="assets/toolbar/bucket.svg" draggable = "false">
        </div>
        <div class = "tool">
            <img src="assets/toolbar/shape.svg" draggable = "false">
        </div>
    </div>
    <ul id = "figure_ctx_menu">
        <li id = "del_option">Delete</li>
        <li id = "dup_option">Duplicate</li>
    </ul>
    <div id="canvas-container">
        <canvas id = "canvas" width = "800" height = "600"></canvas>
    </div>
    <button id = "clearBtn">Clear canvas</button>
    <form name="drawingOptions">
        <p>
            <label for="mode">Drawing mode:</label>
            <select name="mode" size="1">
                <option value="pencil">Pencil</option>
                <option value="line">Line</option>
                <option value="rect">Rectangle</option>
                <option value="triangle">Triangle</option>
                <option value="circle">Circle</option>
                <option value="fill">Fill</option>
                <option value="move">Move</option>
            </select>
        </p>
        <p>
            <label for="p-width">Pencil width:</label>
            <input type="range" name="p-width" min="1" max="10" step="1">
        </p>
        <p>
            <label for="p-opacity">Pencil opacity:</label>
            <input type="range" name="p-opacity" min="0" max="1" step="0.1">
        </p>
        <p>
            <label for="f-color">Fill color:</label>
            <input type="color" name="f-color">
        </p>
        <p>
            <label for="s-color">Stroke color:</label>
            <input type="color" name="s-color">
        </p>
        <p>
            <label for="s-color">Canvas color:</label>
            <input type="color" name="c-color">
        </p>
    </form>
    </div>
    <script>
        let activeTool = document.getElementById('pencil')
        activeTool.style.border = '3px solid black'
        let mode = document.forms[0]['mode']
        let pencilWidth = document.forms[0]['p-width']
        let pencilOpacity = document.forms[0]['p-opacity']
        let fillColor = document.forms[0]['f-color']
        let strokeColor = document.forms[0]['s-color']
        let canvasColor = document.forms[0]['c-color']
        mode.addEventListener('input', (event) => {
            let tool = document.getElementById(event.target.value)
            tool.style.border = '3px solid black'
            activeTool.style.border = ''
            activeTool = tool
        })
        pencilWidth.addEventListener('input', (event) => {
            ctx.lineWidth = event.target.value
        })
        pencilOpacity.addEventListener('input', (event) => {
            ctx.globalAlpha = event.target.value
        })
        fillColor.addEventListener('input', (event) => {
            ctx.fillStyle = event.target.value
        })
        strokeColor.addEventListener('input', (event) => {
            ctx.strokeStyle = event.target.value
        })
        canvasColor.addEventListener('input', (event) => {
            document.getElementById('canvas').style.backgroundColor = event.target.value
        })
        let tools = document.getElementsByClassName('tool')
        for(let tool of tools){
            tool.addEventListener('click',() => {
                activeTool.style.border = ''
                activeTool = tool
                tool.style.border = '3px solid black'
                document.forms[0].mode.value = tool.id
            })
        }
        window.addEventListener('keypress',(event) => {
            let keyCode = event.code.slice(event.code.length-1, event.code.length)
            if(keyCode == 'R'){
                const worker = Tesseract.createWorker({
                logger: m => console.log(m)
                });
                //Tesseract.setLogging(true);
                work();
                async function work() {
                    await worker.load();
                    await worker.loadLanguage('rus');
                    await worker.initialize('rus');
                    let result = await worker.recognize(document.getElementById('canvas'));
                    alert(result.data.text);
                    await worker.terminate();
                }
            }
        })
    </script>
    <script src = "scripts/canvas.js"></script>
</body>
</html>